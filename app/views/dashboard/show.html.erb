<% content_for(:per_page_js) do
   # load the mapping API
   javascript_include_tag("https://maps.googleapis.com/maps/api/js?sensor=false") +
   
   # load report stuff
   report_js_includes
end %>

<% cache(@cache_key) do %>
  
  <%# placing this up here so it's the first call to document.ready, so that the pane sizing happens before report drawing %>
  <%= javascript_doc_ready do %>
    new ELMO.Views.Dashboard({
      map: {
        locations: <%=j @location_answers.to_json.html_safe %>,
        info_window_url: <%=j dashboard_info_window_url.to_json.html_safe %>
      },
      report: {
        id: <%= @report.id %>
      }
    });
  <% end %>
  
  <div class="col left_col">
    <h2><%= t('dashboard.recent_responses') %></h2>

    <div class="recent_responses">
      <% if @responses.empty? %>
        <%= t('will_paginate.response.page_entries_info.single_page_html.zero') %>
      <% else %>
        <%= index_table(Response, @responses, :table_only => true) %>
      <% end %>
    </div>

    <h2 class="interior"><%= t('dashboard.response_locations') %></h2>

    <div class="response_locations">
    </div>

  </div>

  <div class="col right_col">
    <div class="report_stats">
      <div class="stat_block">
        <h2><%= t('dashboard.summary') %></h2>
        <ul>
          <li><%= link_to(translate_recent_responses(@recent_responses_count), responses_path) %></li>
          <li><%= link_to(tmd("welcome.total_responses", :count => @total_response_count), responses_path) %></li>
          <li><%= link_to(tmd("welcome.awaiting_review", :count => @unreviewed_response_count), responses_path(:search => "reviewed:no")) %></li>
        </ul>
      </div>
      <div class="stat_block">
        <% unless @responses.empty? %>
          <h2><%= t('dashboard.top_forms') %></h2>
          <ul>
            <% @responses_by_form.each do |row| %>
              <li><%= link_to("<strong>#{row['count']}</strong> ".html_safe + row['form_name'], responses_path(:search => "form:\"#{row['form_name']}\"")) %></li>
            <% end %>
          </ul>
        <% end %>
      </div>
    </div>
  
    <div class="report_pane">
      <%= render('report_pane') %>
    </div>
  </div>
  <%= link_to(t('dashboard.close_dashboard'), root_path, :class => 'close_dashboard') %>
  
<% end %>